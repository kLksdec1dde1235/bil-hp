<section id="debtEmergencyHero" aria-label="채무긴급대응 히어로 슬라이더">
  <style>
    /* ===============================
       Scope: #debtEmergencyHero ONLY
       =============================== */
    #debtEmergencyHero{
      /* 다른 코드와 섞어 넣어도 겹침/충돌 최소화 */
      position:relative;
      display:block;
      width:100%;
      isolation:isolate;          /* z-index 격리 */
      contain:layout paint style; /* 레이아웃/페인트 범위 제한 */

      --bg:#111;
      --ink:#fff;
      --dim:rgba(0,0,0,.5);
      --accent:#ffeb55;
      --btn:#fff;
      --btn-ink:#111;
      --muted:rgba(255,255,255,.78);

      --padX:clamp(14px, 3.4vw, 44px);
      --title:clamp(26px, 3.2vw, 43px);
      --title-sm:clamp(24px, 6vw, 34px);
      --title-xs:clamp(22px, 7vw, 26px);

      --delay:5000ms;
      --speed:1000ms;

      font-family:Pretendard,"Noto Sans KR",system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
      background:var(--bg);
      color:var(--ink);
      overflow:hidden;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    #debtEmergencyHero *{box-sizing:border-box;}
    #debtEmergencyHero img{max-width:100%;height:auto;}
    #debtEmergencyHero a{color:inherit;}

    /* 외부 CSS가 transform을 강제하는 경우 방어(내부 레이아웃만 보호) */
    #debtEmergencyHero .deh-shell,
    #debtEmergencyHero .deh-stage,
    #debtEmergencyHero .deh-slides,
    #debtEmergencyHero .deh-slide{transform:none;}

    /* ====== Frame ====== */
    #debtEmergencyHero .deh-shell{position:relative; width:100%;}
    #debtEmergencyHero .deh-stage{
      width:100%;
      height:min(90vh, 900px);
      min-height:520px;
      position:relative;
      overflow:hidden;

      /* 드래그 UX */
      touch-action:pan-y;
      user-select:none;
      -webkit-user-select:none;
      cursor:grab;
    }
    #debtEmergencyHero .deh-stage:active{cursor:grabbing;}
    @media (max-width: 560px){
      #debtEmergencyHero .deh-stage{min-height:520px; height:90vh;}
    }

    /* ====== Slides (fade) ====== */
    #debtEmergencyHero .deh-slides{position:relative; width:100%; height:100%;}
    #debtEmergencyHero .deh-slide{
      position:absolute;
      inset:0;
      opacity:0;
      transition:opacity var(--speed) ease;
      pointer-events:none;
      will-change:opacity;
    }
    #debtEmergencyHero .deh-slide.is-active{opacity:1; pointer-events:auto;}

    /* 드래그 중에는 두 장이 동시에 보이며, JS가 opacity를 실시간 제어 */
    #debtEmergencyHero.is-dragging .deh-slide{transition:none !important;}
    #debtEmergencyHero .deh-slide.is-peek{opacity:0; pointer-events:none;}

    /* BG zoom (Ken Burns) */
    #debtEmergencyHero .deh-bg{
      position:absolute;
      inset:0;
      background-size:cover;
      background-position:center;
      transform:scale(1);
      transition:transform 6000ms ease;
      filter:brightness(.5);
      will-change:transform;
    }
    #debtEmergencyHero .deh-slide.is-active .deh-bg{transform:scale(1.12);}

    /* Dim overlay */
    #debtEmergencyHero .deh-dim{position:absolute; inset:0; background:var(--dim);}

    /* ====== Text Box ====== */
    #debtEmergencyHero .deh-txt{
      position:absolute;
      top:20%;
      left:var(--padX);
      right:var(--padX);
      max-width:640px;
      z-index:2;
      pointer-events:auto;
    }
    #debtEmergencyHero .deh-cate{
      display:inline-block;
      font-size:18px;
      font-weight:600;
      margin-bottom:14px;
      color:var(--accent);
    }
    #debtEmergencyHero .deh-title{
      font-size:var(--title);
      line-height:1.4;
      margin:0 0 12px;
      letter-spacing:-0.2px;
    }
    #debtEmergencyHero .deh-title p{margin:0;}
    @media (max-width:620px){ #debtEmergencyHero .deh-title{font-size:var(--title-sm);} }
    @media (max-width:500px){ #debtEmergencyHero .deh-title{font-size:var(--title-xs);} }

    #debtEmergencyHero .deh-desc{
      font-size:18px;
      line-height:1.6;
      font-weight:300;
      color:var(--muted);
    }

    /* ====== CTA Button ====== */
    #debtEmergencyHero .deh-btn{
      display:inline-block;
      margin-top:30px;
      padding:14px 36px;
      border:2px solid #fff;
      border-radius:40px;
      background:transparent;
      color:#fff;
      font-weight:600;
      letter-spacing:.3px;
      text-decoration:none;

      opacity:0;
      pointer-events:none;

      transition:opacity .6s ease, background .35s ease, box-shadow .35s ease, color .35s ease, transform .35s ease;
      position:relative;
      overflow:hidden;
    }
    #debtEmergencyHero .deh-slide.is-active .deh-btn{opacity:1; pointer-events:auto;}
    #debtEmergencyHero .deh-btn::after{
      content:"";
      position:absolute;
      inset:0;
      background:rgba(255,255,255,.15);
      transform:translateX(-100%);
      transition:transform .4s ease;
    }
    #debtEmergencyHero .deh-btn:hover::after{transform:translateX(0);}
    #debtEmergencyHero .deh-btn:hover{
      background:var(--btn);
      color:var(--btn-ink);
      box-shadow:0 8px 24px rgba(0,0,0,.25);
      transform:translateY(-2px);
    }

    /* ====== Wave animation (고유 클래스) ====== */
    #debtEmergencyHero .deh-wave_anim .deh-wave{
      display:inline-block;
      opacity:0;
      transform:translateY(25px);
      will-change:transform, opacity;
    }
    #debtEmergencyHero .deh-slide.is-active .deh-wave_anim .deh-wave{animation: deh-wave 1.1s ease-out forwards;}
    @keyframes deh-wave{0%{transform:translateY(25px);opacity:0}100%{transform:translateY(0);opacity:1}}

    #debtEmergencyHero .deh-slide.is-active .deh-wave_anim.custom .deh-wave:nth-child(1){animation-delay:.15s}
    #debtEmergencyHero .deh-slide.is-active .deh-wave_anim.custom .deh-wave:nth-child(2){animation-delay:.3s}
    #debtEmergencyHero .deh-slide.is-active .deh-wave_anim.custom .deh-wave:nth-child(3){animation-delay:.45s}
    #debtEmergencyHero .deh-slide.is-active .deh-wave_anim.custom .deh-wave:nth-child(4){animation-delay:.6s}
    #debtEmergencyHero .deh-slide.is-active .deh-wave_anim.custom .deh-wave:nth-child(5){animation-delay:.75s}

    /* ====== Progress ====== */
    #debtEmergencyHero .deh-progress{
      position:absolute;
      bottom:80px;
      left:var(--padX);
      right:var(--padX);
      z-index:3;
      height:4px;
      display:flex;
      gap:10px;
      width:150px;
      max-width:calc(100% - (var(--padX) * 2));
    }
    #debtEmergencyHero .deh-seg{
      flex:1;
      background:rgba(255,255,255,.25);
      border-radius:2px;
      overflow:hidden;
      cursor:pointer;
      border:0;
      padding:0;
      appearance:none;
      -webkit-appearance:none;
    }
    #debtEmergencyHero .deh-fill{display:block; width:0%; height:100%; background:#fff;}

    /* ====== Wheel down ====== */
    #debtEmergencyHero .deh-wheel{
      position:absolute;
      bottom:14px;
      left:50%;
      transform:translateX(-50%);
      width:24px;
      opacity:.7;
      z-index:3;
      pointer-events:none;
    }
    #debtEmergencyHero .deh-wheel .wheel{
      animation: deh-wheel-fade 2s ease-in-out infinite;
      transform-origin:center;
    }
    @keyframes deh-wheel-fade{
      0%{opacity:1; transform:translateY(0)}
      80%{opacity:.2; transform:translateY(10px)}
      100%{opacity:0; transform:translateY(14px)}
    }

    /* ====== Viewport reveal (재진입 시 반복) ====== */
    #debtEmergencyHero [data-deh-reveal]{
      opacity:0;
      transform:translateY(16px);
      transition:opacity .8s ease, transform .8s ease;
      will-change:opacity, transform;
    }
    #debtEmergencyHero .is-revealed[data-deh-reveal]{
      opacity:1;
      transform:translateY(0);
    }

    /* 접근성: 모션 최소화 */
    @media (prefers-reduced-motion: reduce){
      #debtEmergencyHero .deh-bg,
      #debtEmergencyHero .deh-slide,
      #debtEmergencyHero .deh-btn,
      #debtEmergencyHero [data-deh-reveal],
      #debtEmergencyHero .deh-wheel .wheel{
        transition:none !important;
        animation:none !important;
        transform:none !important;
      }
      #debtEmergencyHero .deh-slide{opacity:1 !important; position:relative;}
      #debtEmergencyHero .deh-slides{display:block;}
      #debtEmergencyHero .deh-btn{opacity:1 !important; pointer-events:auto !important;}
      #debtEmergencyHero .deh-progress{display:none;}
      #debtEmergencyHero .deh-wave_anim .deh-wave{opacity:1 !important;}
    }
  </style>

  <div class="deh-shell">
    <div class="deh-stage" role="region" aria-roledescription="carousel" aria-label="채무긴급대응 슬라이더" tabindex="0">
      <div class="deh-slides" data-deh-slides>

        <!-- Slide 1 -->
        <article class="deh-slide is-active" data-deh-slide aria-label="1 / 5">
          <div class="deh-bg" style="background-image:url('./img/1.jpg');"></div>
          <div class="deh-dim" aria-hidden="true"></div>
          <div class="deh-txt" data-deh-reveal>
            <span class="deh-cate deh-wave_anim custom"><span class="deh-wave">채무긴급대응 법률센터</span></span>
            <h2 class="deh-title deh-wave_anim custom">
              <p class="deh-wave">급여·통장 압류로 인하여</p>
              <p class="deh-wave">월급이 막혀 카드,세금, 공과금</p>
              <p class="deh-wave">연체 위기에 처해있다면?</p>
            </h2>
            <p class="deh-desc deh-wave_anim custom">
              <span class="deh-wave">채무조정정부제도를 통해<br>빠르게 압류를 풀고<br>연체 위기에 벗어날 수 있도록<br>신속하게 도와드립니다.</span>
            </p>
            <a class="deh-btn" href="tel:02-593-9191">100% 비밀보장 긴급 안심콜</a>
          </div>
        </article>

        <!-- Slide 2 -->
        <article class="deh-slide" data-deh-slide aria-label="2 / 5">
          <div class="deh-bg" style="background-image:url('./img/2.jpg');"></div>
          <div class="deh-dim" aria-hidden="true"></div>
          <div class="deh-txt" data-deh-reveal>
            <span class="deh-cate deh-wave_anim custom"><span class="deh-wave">채무긴급대응 법률센터</span></span>
            <h2 class="deh-title deh-wave_anim custom">
              <p class="deh-wave">재산 압류로 인하여</p>
              <p class="deh-wave">평생 쌓은 자산을 잃을</p>
              <p class="deh-wave">심각한 위기에 처해 있다면?</p>
            </h2>
            <p class="deh-desc deh-wave_anim custom">
              <span class="deh-wave">경매 및 압류 즉시 중단 및<br>여러분의 소중한 재산을<br>지킬 수 있도록 도와드립니다.</span>
            </p>
            <a class="deh-btn" href="tel:02-593-9191">100% 비밀보장 긴급 안심콜</a>
          </div>
        </article>

        <!-- Slide 3 -->
        <article class="deh-slide" data-deh-slide aria-label="3 / 5">
          <div class="deh-bg" style="background-image:url('./img/3.jpg');"></div>
          <div class="deh-dim" aria-hidden="true"></div>
          <div class="deh-txt" data-deh-reveal>
            <span class="deh-cate deh-wave_anim custom"><span class="deh-wave">채무긴급대응 법률센터</span></span>
            <h2 class="deh-title deh-wave_anim custom">
              <p class="deh-wave">채권추심(협박성 독촉)으로</p>
              <p class="deh-wave">직장·가정까지 위협받는</p>
              <p class="deh-wave">위기의 순간에 있다면?</p>
            </h2>
            <p class="deh-desc deh-wave_anim custom">
              <span class="deh-wave">추심 즉각 중단하고<br>가족들이 보호받을 수 있도록<br>빠르게 법률 대응해드립니다.</span>
            </p>
            <a class="deh-btn" href="tel:02-593-9191">100% 비밀보장 긴급 안심콜</a>
          </div>
        </article>

        <!-- Slide 4 -->
        <article class="deh-slide" data-deh-slide aria-label="4 / 5">
          <div class="deh-bg" style="background-image:url('./img/4.jpg');"></div>
          <div class="deh-dim" aria-hidden="true"></div>
          <div class="deh-txt" data-deh-reveal>
            <span class="deh-cate deh-wave_anim custom"><span class="deh-wave">채무긴급대응 법률센터</span></span>
            <h2 class="deh-title deh-wave_anim custom">
              <p class="deh-wave">이자가 감당이 안되고</p>
              <p class="deh-wave">연체로 신용불량 직전에</p>
              <p class="deh-wave">견디기 힘든 압박을 느낀다면?</p>
            </h2>
            <p class="deh-desc deh-wave_anim custom">
              <span class="deh-wave">견디기 힘든 빚을 줄이고<br>일상을 회복할 수 있도록<br>빠르게 도와드립니다.</span>
            </p>
            <a class="deh-btn" href="tel:02-593-9191">100% 비밀보장 긴급 안심콜</a>
          </div>
        </article>

        <!-- Slide 5 -->
        <article class="deh-slide" data-deh-slide aria-label="5 / 5">
          <div class="deh-bg" style="background-image:url('./img/5.jpg');"></div>
          <div class="deh-dim" aria-hidden="true"></div>
          <div class="deh-txt" data-deh-reveal>
            <span class="deh-cate deh-wave_anim custom"><span class="deh-wave">채무긴급대응 법률센터</span></span>
            <h2 class="deh-title deh-wave_anim custom">
              <p class="deh-wave">전세사기, 로맨스 스캠 등</p>
              <p class="deh-wave">예상 못한 금액 피해로</p>
              <p class="deh-wave">어려운 상황에 처해있다면?</p>
            </h2>
            <p class="deh-desc deh-wave_anim custom">
              <span class="deh-wave">예상 못한 상황에서<br>법률 조치를 취할 수 있게<br>빠르게 도와드립니다.</span>
            </p>
            <a class="deh-btn" href="tel:02-593-9191">100% 비밀보장 긴급 안심콜</a>
          </div>
        </article>

      </div>

      <div class="deh-progress" data-deh-progress aria-label="슬라이드 진행 표시"></div>

      <span class="deh-wheel" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 30" width="24" height="36" focusable="false">
          <path fill="#fff" d="M10,0C4.5,0,0,4.5,0,10v10c0,5.5,4.5,10,10,10s10-4.5,10-10V10C20,4.5,15.5,0,10,0z M19,20c0,5-4,9-9,9
                              s-9-4-9-9V10c0-5,4-9,9-9s9,4,9,9V20z"></path>
          <path class="wheel" fill="#fff" d="M10,5L10,5c0.6,0,1,0.4,1,1v4c0,0.6-0.4,1-1,1l0,0c-0.6,0-1-0.4-1-1V6C9,5.4,9.4,5,10,5z"></path>
        </svg>
      </span>
    </div>
  </div>

  <script>
    (function(){
      const root = document.getElementById('debtEmergencyHero');
      if(!root) return;

      const stage = root.querySelector('.deh-stage');
      const slides = Array.from(root.querySelectorAll('[data-deh-slide]'));
      const progress = root.querySelector('[data-deh-progress]');

      const prefersReduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const DELAY = prefersReduce ? 999999999 : parseInt(getComputedStyle(root).getPropertyValue('--delay')) || 5000;

      if(!slides.length || !progress) return;

      let idx = 0;
      let timer = 0;

      // ---- Progress segments ----
      const fills = [];
      slides.forEach((_, i) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'deh-seg';
        btn.setAttribute('aria-label', `슬라이드 ${i+1}로 이동`);

        const fill = document.createElement('span');
        fill.className = 'deh-fill';
        btn.appendChild(fill);

        btn.addEventListener('click', () => goTo(i, true));
        progress.appendChild(btn);
        fills.push(fill);
      });

      function resetFill(el){
        el.style.transition = 'none';
        el.style.width = '0%';
        void el.offsetWidth;
      }

      function animateFill(i){
        fills.forEach((f, j) => {
          f.style.transition = 'none';
          f.style.width = (j < i) ? '100%' : '0%';
        });
        const active = fills[i];
        if(!active) return;
        void active.offsetWidth;
        active.style.transition = `width ${DELAY}ms linear`;
        active.style.width = '100%';
      }

      // ---- Wave animation retrigger ----
      function retriggerWave(slide){
        const waves = slide.querySelectorAll('.deh-wave_anim .deh-wave');
        waves.forEach(w => { w.style.animation = 'none'; });
        void slide.offsetWidth;
        waves.forEach(w => { w.style.animation = ''; });
      }

      function setActive(i){
        slides.forEach((s, j) => {
          if(j === i) s.classList.add('is-active');
          else s.classList.remove('is-active');
          s.setAttribute('aria-hidden', j === i ? 'false' : 'true');
        });
        retriggerWave(slides[i]);
        animateFill(i);
      }

      function clearTimer(){
        if(timer) window.clearTimeout(timer);
        timer = 0;
      }

      function scheduleNext(){
        clearTimer();
        timer = window.setTimeout(() => {
          goTo((idx + 1) % slides.length, false);
        }, DELAY);
      }

      function goTo(next){
        if(next === idx){
          resetFill(fills[idx]);
          setActive(idx);
          if(!prefersReduce) scheduleNext();
          return;
        }
        idx = (next + slides.length) % slides.length;
        setActive(idx);
        if(!prefersReduce) scheduleNext();
      }

      // ---- Unified drag (PointerEvents: mouse + touch) ----
      let psx = 0, psy = 0;
      let pdx = 0;
      let dragging = false;
      let dragDir = 0; // -1 prev, +1 next
      let dragRAF = 0;
      let pointerActive = false;
      let activePointerId = null;
      const TH = 8;
      const SNAP = 0.20;

      function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

      function ensurePeek(dir){
        const peekIndex = (idx + dir + slides.length) % slides.length;
        slides.forEach((s, j) => {
          if(j === peekIndex) s.classList.add('is-peek');
          else s.classList.remove('is-peek');
        });
        return peekIndex;
      }

      function applyDragVisual(p, dir){
        const peekIndex = ensurePeek(dir);
        const cur = slides[idx];
        const peek = slides[peekIndex];

        slides.forEach((s, j) => {
          if(j !== idx && j !== peekIndex) s.style.opacity = '0';
        });

        cur.style.opacity = String(1 - (p * 0.9));
        peek.style.opacity = String(p);
      }

      function clearInlineOpacity(){
        slides.forEach(s => { s.style.opacity = ''; });
      }

      function endDrag(commit){
        root.classList.remove('is-dragging');
        dragging = false;
        pointerActive = false;
        activePointerId = null;
        if(dragRAF){ cancelAnimationFrame(dragRAF); dragRAF = 0; }

        slides.forEach(s => s.classList.remove('is-peek'));
        clearInlineOpacity();

        if(commit) goTo((idx + dragDir + slides.length) % slides.length, true);
        else{
          resetFill(fills[idx]);
          setActive(idx);
          if(!prefersReduce) scheduleNext();
        }
      }

      function onPointerDown(e){
        if(prefersReduce) return;
        if(e.pointerType === 'mouse' && e.button !== 0) return;

        pointerActive = true;
        activePointerId = e.pointerId;
        psx = e.clientX;
        psy = e.clientY;
        pdx = 0;
        dragging = false;
        dragDir = 0;

        clearTimer();
        try{ stage.setPointerCapture(e.pointerId); }catch(_){}
      }

      function onPointerMove(e){
        if(!pointerActive || e.pointerId !== activePointerId) return;
        pdx = e.clientX - psx;
        const pdy = e.clientY - psy;

        if(!dragging){
          if(Math.abs(pdx) > Math.abs(pdy) + 6 && Math.abs(pdx) > TH){
            dragging = true;
            root.classList.add('is-dragging');
          }else return;
        }

        e.preventDefault();

        const w = Math.max(1, stage.clientWidth);
        const p = clamp(Math.abs(pdx) / w, 0, 1);
        dragDir = (pdx < 0) ? +1 : -1;

        if(!dragRAF){
          dragRAF = requestAnimationFrame(() => {
            dragRAF = 0;
            applyDragVisual(p, dragDir);
          });
        }
      }

      function onPointerUp(e){
        if(!pointerActive || e.pointerId !== activePointerId) return;

        const w = Math.max(1, stage.clientWidth);
        const p = clamp(Math.abs(pdx) / w, 0, 1);

        if(!dragging){
          pointerActive = false;
          activePointerId = null;
          if(!prefersReduce) scheduleNext();
          return;
        }

        endDrag(p >= SNAP);
      }

      function onPointerCancel(e){
        if(!pointerActive || e.pointerId !== activePointerId) return;
        if(dragging) endDrag(false);
        else{
          pointerActive = false;
          activePointerId = null;
          if(!prefersReduce) scheduleNext();
        }
      }

      stage.addEventListener('pointerdown', onPointerDown, {passive:false});
      stage.addEventListener('pointermove', onPointerMove, {passive:false});
      stage.addEventListener('pointerup', onPointerUp, {passive:true});
      stage.addEventListener('pointercancel', onPointerCancel, {passive:true});

      // ---- Keyboard ----
      stage.addEventListener('keydown', (e) => {
        if(e.key === 'ArrowRight') goTo(idx + 1, true);
        if(e.key === 'ArrowLeft') goTo(idx - 1, true);
      });

      // ---- Viewport reveal (재진입 반복) ----
      const revealEls = Array.from(root.querySelectorAll('[data-deh-reveal]'));
      const io = new IntersectionObserver((entries) => {
        entries.forEach(ent => {
          if(ent.isIntersecting) ent.target.classList.add('is-revealed');
          else ent.target.classList.remove('is-revealed');
        });
      }, {threshold:0.35});
      revealEls.forEach(el => io.observe(el));

      // ---- Pause on tab hidden ----
      document.addEventListener('visibilitychange', () => {
        if(prefersReduce) return;
        if(document.hidden) clearTimer();
        else{
          resetFill(fills[idx]);
          setActive(idx);
          scheduleNext();
        }
      });

      // init
      setActive(0);
      if(!prefersReduce) scheduleNext();
    })();
  </script>
</section>
